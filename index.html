<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Login Supabase</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body{font-family:sans-serif;background:#111;color:#fff;display:flex;justify-content:center;align-items:center;height:100vh}
.box{background:#1e1e1e;padding:30px;border-radius:10px;width:300px}
input,button{width:100%;padding:10px;margin:8px 0}
button{cursor:pointer}
.error{color:#ff4d4d}
</style>
</head>

<body>

<div class="box">
<h2>Connexion</h2>
<select id="type">
<option value="admin">Admin</option>
<option value="group1">Groupe 1</option>
<option value="group2">Groupe 2</option>
<option value="student">Étudiant</option>
</select>
<input id="username" placeholder="Utilisateur">
<input id="password" type="password" placeholder="Mot de passe">
<button onclick="login()">Connexion</button>
<div class="error" id="error"></div>
</div>

<script>
const SUPABASE_URL = "https://bsswnborkzyjqyvvxpci.supabase.co";
const SUPABASE_KEY = "TON_ANON_KEY_ICI";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

async function login(){
document.getElementById("error").textContent="";

const type=document.getElementById("type").value;
const u=document.getElementById("username").value;
const p=document.getElementById("password").value;

let table, field, extra=null;

if(type==="admin"){table="admins";field="username";}
else if(type==="student"){table="students";field="username";}
else{table="groups";field="id";extra=parseInt(type.replace("group",""));}

let q=supabase.from(table).select("*");

if(extra!==null) q=q.eq(field,extra);
else q=q.eq(field,u);

const {data,error}=await q.single();

if(error||!data){
document.getElementById("error").textContent="Nom d'utilisateur ou mot de passe incorrect!";
return;
}

const {data:ok,error:rpcErr}=await supabase.rpc("verify_password",{
plain_password:p,
hashed_password:data.password_hash
});

if(rpcErr||!ok){
document.getElementById("error").textContent="Nom d'utilisateur ou mot de passe incorrect!";
return;
}

alert("Connexion réussie : "+type);
}
</script>

</body>
</html>
